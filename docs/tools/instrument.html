<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.25.1">
    <meta name="project" content="tools v3.5">

    <title>instrument â€” tools v3.5</title>
    <link rel="stylesheet" href="dist/erlang-951161c89561e05735a5.css" />

    <script src="dist/sidebar_items-b955672ef1.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/app-f97730d45ef67f3e6188.js"></script>


  </head>
  <body data-type="modules">
    <script>

      try {
        if (localStorage.getItem('night-mode') === 'true') {
          document.body.classList.add('night-mode');
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle">
  <span class="icon-menu" title="Collapse/expand sidebar"></span>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <span class="icon-search" aria-hidden="true" title="Submit search"></span>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <span class="icon-cross" aria-hidden="true" title="Cancel search"></span>
    </button>
    <label class="search-label">
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">
    <div class="sidebar-projectDetails">
      <a href="api-reference.html" class="sidebar-projectName">
tools
      </a>
      <strong class="sidebar-projectVersion">
        v3.5
      </strong>
    </div>

  </div>

  <ul class="sidebar-listNav">
    <li><a id="extras-list-link" href="#full-list">Pages</a></li>

      <li><a id="modules-list-link" href="#full-list">Modules</a></li>


  </ul>
  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <div class="content-outer">
    <div id="content" class="content-inner">

      <h1>
instrument <small class="app-vsn">(tools v3.5)</small>

      </h1>


        <section id="moduledoc">
<p>The module <code>instrument</code> contains support for studying the resource usage in an Erlang runtime system. Currently, only the allocation of memory can be studied.</p><div class="note"><p>Note that this whole module is experimental, and the representations used as well as the functionality is likely to change in the future.</p></div><h2 id="module-see-also" class="section-heading">
  <a href="#module-see-also" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  See Also
</h2>
<p>erts_alloc(3), erl(1)</p>
        </section>


        <section id="summary" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#summary">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
            Summary
          </h1>

  <div class="summary-types summary">
    <h2>
      <a href="#types">Types</a>
    </h2>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#t:allocation_summary/0">-type allocation_summary() :: term().</a>

  </div>

    <div class="summary-synopsis"><p>A summary of allocated block sizes (including their headers) grouped by their <code>Origin</code> and <code>Type</code>.</p></div>

</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#t:block_histogram/0">-type block_histogram() :: term().</a>

  </div>

    <div class="summary-synopsis"><p>A histogram of block sizes where each interval's upper bound is twice as high as the one before it.</p></div>

</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#t:carrier_info_list/0">-type carrier_info_list() :: term().</a>

  </div>

    <div class="summary-synopsis"><p><code>AllocatorType</code> is the type of the allocator that employs this carrier.</p></div>

</div>

  </div>

  <div class="summary-functions summary">
    <h2>
      <a href="#functions">Functions</a>
    </h2>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#allocations/0">allocations/0</a>

  </div>

    <div class="summary-synopsis"><p>Shorthand for <a href="instrument.html#allocations/1"><code>allocations(#{})</code>.</a></p></div>

</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#allocations/1">allocations/1</a>

  </div>

    <div class="summary-synopsis"><p>Returns a summary of all tagged allocations in the system, optionally filtered by allocator type and scheduler id.</p></div>

</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#carriers/0">carriers/0</a>

  </div>

    <div class="summary-synopsis"><p>Shorthand for <a href="instrument.html#carriers/1"><code>carriers(#{})</code>.</a></p></div>

</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#carriers/1">carriers/1</a>

  </div>

    <div class="summary-synopsis"><p>Returns a summary of all carriers in the system, optionally filtered by allocator type and scheduler id.</p></div>

</div>

  </div>

        </section>


        <section id="types" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#types">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
Types
          </h1>
          <div class="types-list">
<section class="detail" id="t:allocation_summary/0">

  <div class="detail-header">
    <a href="#t:allocation_summary/0" class="detail-link" title="Link to this type">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature">-type allocation_summary() :: term().</h1>


  </div>

  <section class="docstring">

      <h2>Specs</h2>
      <div class="specs">

          <pre>allocation_summary() ::
    {HistogramStart :: non_neg_integer(),
     UnscannedSize :: non_neg_integer(),
     Allocations :: #{Origin :: atom() => #{Type :: atom() => <a href="#t:block_histogram/0">block_histogram</a>()}}}.</pre>

      </div>

<p>A summary of allocated block sizes (including their headers) grouped by their <code>Origin</code> and <code>Type</code>.</p><p><code>Origin</code> is generally which NIF or driver that allocated the blocks, or 'system' if it could not be determined.</p><p><code>Type</code> is the allocation category that the blocks belong to, e.g. <code>db_term</code>, <code>message</code> or <code>binary</code>.</p><p>If one or more carriers could not be scanned in full without harming the responsiveness of the system, <code>UnscannedSize</code> is the number of bytes that had to be skipped.</p>
  </section>
</section>
<section class="detail" id="t:block_histogram/0">

  <div class="detail-header">
    <a href="#t:block_histogram/0" class="detail-link" title="Link to this type">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature">-type block_histogram() :: term().</h1>


  </div>

  <section class="docstring">

      <h2>Specs</h2>
      <div class="specs">

          <pre>block_histogram() :: tuple().</pre>

      </div>

<p>A histogram of block sizes where each interval's upper bound is twice as high as the one before it.</p><p>The upper bound of the first interval is provided by the function that returned the histogram, and the last interval has no upper bound.</p>
  </section>
</section>
<section class="detail" id="t:carrier_info_list/0">

  <div class="detail-header">
    <a href="#t:carrier_info_list/0" class="detail-link" title="Link to this type">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature">-type carrier_info_list() :: term().</h1>


  </div>

  <section class="docstring">

      <h2>Specs</h2>
      <div class="specs">

          <pre>carrier_info_list() ::
    {HistogramStart :: non_neg_integer(),
     Carriers ::
         [{AllocatorType :: atom(),
           InPool :: boolean(),
           TotalSize :: non_neg_integer(),
           UnscannedSize :: non_neg_integer(),
           Allocations :: {Type :: atom(), Count :: non_neg_integer(), Size :: non_neg_integer()},
           FreeBlocks :: <a href="#t:block_histogram/0">block_histogram</a>()}]}.</pre>

      </div>

<p><code>AllocatorType</code> is the type of the allocator that employs this carrier.</p><p><code>InPool</code> is whether the carrier is in the migration pool.</p><p><code>TotalSize</code> is the total size of the carrier, including its header.</p><p><code>Allocations</code> is a summary of the allocated blocks in the carrier.</p><p><code>FreeBlocks</code> is a histogram of the free block sizes in the carrier.</p><p>If the carrier could not be scanned in full without harming the responsiveness of the system, <code>UnscannedSize</code> is the number of bytes that had to be skipped.</p>
  </section>
</section>

          </div>
        </section>

        <section id="functions" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#functions">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
Functions
          </h1>
          <div class="functions-list">
<section class="detail" id="allocations/0">

  <div class="detail-header">
    <a href="#allocations/0" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">allocations/0</h1>


      <span class="note">(since OTP 21.0)</span>

  </div>

  <section class="docstring">

      <h2>Specs</h2>
      <div class="specs">

          <pre>allocations() -> {ok, Result} | {error, Reason}
               when Result :: <a href="#t:allocation_summary/0">allocation_summary</a>(), Reason :: not_enabled.</pre>

      </div>

<p>Shorthand for <a href="instrument.html#allocations/1"><code>allocations(#{})</code>.</a></p>
  </section>
</section>
<section class="detail" id="allocations/1">

  <div class="detail-header">
    <a href="#allocations/1" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">allocations/1</h1>


      <span class="note">(since OTP 21.0)</span>

  </div>

  <section class="docstring">

      <h2>Specs</h2>
      <div class="specs">

          <pre>allocations(Options) -> {ok, Result} | {error, Reason}
               when
                   Result :: <a href="#t:allocation_summary/0">allocation_summary</a>(),
                   Reason :: not_enabled,
                   Options ::
                       #{scheduler_ids => [non_neg_integer()],
                         allocator_types => [atom()],
                         histogram_start => pos_integer(),
                         histogram_width => pos_integer()}.</pre>

      </div>

<p>Returns a summary of all tagged allocations in the system, optionally filtered by allocator type and scheduler id.</p><p>Only binaries and allocations made by NIFs and drivers are tagged by default, but this can be configured an a per-allocator basis with the <code>+M&lt;S&gt;atags</code> emulator option.</p><p>If the specified allocator types are not enabled, the call will fail with <code>{error, not_enabled}</code>.</p><p>The following options can be used:</p><dl><dt><code>allocator_types</code></dt><dd><p>The allocator types that will be searched. Note that blocks can move freely between allocator types, so restricting the search to certain allocators may return unexpected types (e.g. process heaps when searching binary_alloc), or hide blocks that were migrated out.</p><p>Defaults to all <code>alloc_util</code> allocators.</p></dd><dt><code>scheduler_ids</code></dt><dd><p>The scheduler ids whose allocator instances will be searched. A scheduler id of 0 will refer to the global instance that is not tied to any particular scheduler. Defaults to all schedulers and the global instance.</p></dd><dt><code>histogram_start</code></dt><dd><p>The upper bound of the first interval in the allocated block size histograms. Defaults to 128.</p></dd><dt><code>histogram_width</code></dt><dd><p>The number of intervals in the allocated block size histograms. Defaults to 18.</p></dd></dl><p><em>Example:</em></p><pre><code type="none">&gt; instrument:allocations(#{ histogram_start =&gt; 128, histogram_width =&gt; 15 }).
{ok,{128,0,
     #{udp_inet =&gt;
           #{driver_event_state =&gt; {0,0,0,0,0,0,0,0,0,1,0,0,0,0,0}},
       system =&gt;
           #{heap =&gt; {0,0,0,0,20,4,2,2,2,3,0,1,0,0,1},
             db_term =&gt; {271,3,1,52,80,1,0,0,0,0,0,0,0,0,0},
             code =&gt; {0,0,0,5,3,6,11,22,19,20,10,2,1,0,0},
             binary =&gt; {18,0,0,0,7,0,0,1,0,0,0,0,0,0,0},
             message =&gt; {0,40,78,2,2,0,0,0,0,0,0,0,0,0,0},
             ... }
       spawn_forker =&gt;
           #{driver_select_data_state =&gt;
                 {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0}},
       ram_file_drv =&gt; #{drv_binary =&gt; {0,0,0,0,0,0,1,0,0,0,0,0,0,0,0}},
       prim_file =&gt;
           #{process_specific_data =&gt; {2,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
             nif_trap_export_entry =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0},
             monitor_extended =&gt; {0,1,0,0,0,0,0,0,0,0,0,0,0,0,0},
             drv_binary =&gt; {0,0,0,0,0,0,1,0,3,5,0,0,0,1,0},
             binary =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0}},
       prim_buffer =&gt;
           #{nif_internal =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0},
             binary =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0}}}}}
     </code></pre>
  </section>
</section>
<section class="detail" id="carriers/0">

  <div class="detail-header">
    <a href="#carriers/0" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">carriers/0</h1>


      <span class="note">(since OTP 21.0)</span>

  </div>

  <section class="docstring">

      <h2>Specs</h2>
      <div class="specs">

          <pre>carriers() -> {ok, Result} | {error, Reason}
            when Result :: <a href="#t:carrier_info_list/0">carrier_info_list</a>(), Reason :: not_enabled.</pre>

      </div>

<p>Shorthand for <a href="instrument.html#carriers/1"><code>carriers(#{})</code>.</a></p>
  </section>
</section>
<section class="detail" id="carriers/1">

  <div class="detail-header">
    <a href="#carriers/1" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">carriers/1</h1>


      <span class="note">(since OTP 21.0)</span>

  </div>

  <section class="docstring">

      <h2>Specs</h2>
      <div class="specs">

          <pre>carriers(Options) -> {ok, Result} | {error, Reason}
            when
                Result :: <a href="#t:carrier_info_list/0">carrier_info_list</a>(),
                Reason :: not_enabled,
                Options ::
                    #{scheduler_ids => [non_neg_integer()],
                      allocator_types => [atom()],
                      histogram_start => pos_integer(),
                      histogram_width => pos_integer()}.</pre>

      </div>

<p>Returns a summary of all carriers in the system, optionally filtered by allocator type and scheduler id.</p><p>If the specified allocator types are not enabled, the call will fail with <code>{error, not_enabled}</code>.</p><p>The following options can be used:</p><dl><dt><code>allocator_types</code></dt><dd><p>The allocator types that will be searched. Defaults to all <code>alloc_util</code> allocators.</p></dd><dt><code>scheduler_ids</code></dt><dd><p>The scheduler ids whose allocator instances will be searched. A scheduler id of 0 will refer to the global instance that is not tied to any particular scheduler. Defaults to all schedulers and the global instance.</p></dd><dt><code>histogram_start</code></dt><dd><p>The upper bound of the first interval in the free block size histograms. Defaults to 512.</p></dd><dt><code>histogram_width</code></dt><dd><p>The number of intervals in the free block size histograms. Defaults to 14.</p></dd></dl><p><em>Example:</em></p><pre><code type="none">&gt; instrument:carriers(#{ histogram_start =&gt; 512, histogram_width =&gt; 8 }).
{ok,{512,
     [{ll_alloc,1048576,0,1048344,71,false,{0,0,0,0,0,0,0,0}},
      {binary_alloc,1048576,0,324640,13,false,{3,0,0,1,0,0,0,2}},
      {eheap_alloc,2097152,0,1037200,45,false,{2,1,1,3,4,3,2,2}},
      {fix_alloc,32768,0,29544,82,false,{22,0,0,0,0,0,0,0}},
      {...}|...]}}
     </code></pre>
  </section>
</section>

          </div>
        </section>

      <footer class="footer">

        <p>
          <span class="line">
            Built using
            <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener">ExDoc</a> (v0.25.1) for the
            <a href="https://elixir-lang.org" title="Elixir" target="_blank">Elixir programming language</a>.
          </span>
          <span class="line">
            Designed by
            <a href="https://twitter.com/dignifiedquire" target="_blank" rel="noopener" title="@dignifiedquire">Friedel Ziegelmayer</a>.
          </span>
        </p>
        <p>

            <a href="api-reference.html" title="API reference" class="line footer-button">API Reference</a>

          <button class="line footer-button display-shortcuts-help">
            Display keyboard shortcuts
          </button>
          <button class="line footer-button night-mode-toggle">
            Toggle night mode
          </button>
          <button class="line footer-button display-quick-switch">
            Go to a HexDocs package
          </button>
          <button class="line footer-button tooltips-toggle">
            <span class="tooltips-option-disable">Disable tooltips</span>
            <span class="tooltips-option-enable">Enable tooltips</span>
          </button>
        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>
